<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mfair">
<title>Spatial and temporal dynamics of gene regulation among brain tissues â€¢ mfair</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial and temporal dynamics of gene regulation among brain tissues">
<meta property="og:description" content="mfair">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mfair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ml100k.html">Enrichment of movie genre information</a>
    <a class="dropdown-item" href="../articles/neocortex.html">Spatial and temporal dynamics of gene regulation among brain tissues</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/YangLabHKUST/mfair/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Spatial and temporal dynamics of gene regulation among brain tissues</h1>
                        <h4 data-toc-skip class="author">WANG Zhiwei,
HKUST</h4>
            
            <h4 data-toc-skip class="date">May 15, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/YangLabHKUST/mfair/blob/HEAD/vignettes/neocortex.Rmd" class="external-link"><code>vignettes/neocortex.Rmd</code></a></small>
      <div class="d-none name"><code>neocortex.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(RhpcBLASctl)</span></span>
<span><span class="co"># blas_set_num_threads(32)</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="co"># devtools::install_github("YangLabHKUST/mfair")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yanglabhkust.github.io/mfair/">mfair</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pheatmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20230515</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-neocortex-dataset">The <code>neocortex</code> dataset<a class="anchor" aria-label="anchor" href="#the-neocortex-dataset"></a>
</h2>
<p>The spatial and temporal patterns of gene regulation during brain
development have attracted a great deal of attention in the neuroscience
community. The availability of gene expression profiles collected from
multiple brain regions and time periods provides an unprecedented chance
to characterize human brain development. Here we select genes with
consistent spatial patterns across individuals using the concept of
differential stability (DS), which is defined as the tendency for a gene
to exhibit reproducible differential expression relationships across
brain structures. We include 2,000 genes with the highest DS and get the
<code>expression</code> matrix, where each row represents a sample
tissue in the nercortex region and each column represents a gene. The
<code>sample_info</code> data frame contains the sample information,
where each row represents a sample tissue and the four columns
respectively represent sample ID, neocortex area, hemisphere, and time
periods.</p>
</div>
<div class="section level2">
<h2 id="fitting-the-mfai-model">Fitting the MFAI model<a class="anchor" aria-label="anchor" href="#fitting-the-mfai-model"></a>
</h2>
<p>We use the <code>expression</code> matrix as the main data matrix
<span class="math inline">\(Y\)</span>, and the spatial and temporal
information contained in the <code>sample_info</code> data frame as the
auxiliary matrix <span class="math inline">\(X\)</span>. Then we proceed
to fit the MFAI model with top three factors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create MFAIR object</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">neocortex</span><span class="op">$</span><span class="va">expression</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">neocortex</span><span class="op">$</span><span class="va">sample_info</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="st">"Stage"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mfairObject</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMFAIR.html">createMFAIR</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span>, K_max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; The main data matrix Y is completely observed!</span></span>
<span><span class="co">#&gt; The main data matrix Y has been centered with mean = 7.64309222668172!</span></span>
<span></span>
<span><span class="co"># Fit the MFAI model</span></span>
<span><span class="va">mfairObject</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGreedy.html">fitGreedy</a></span><span class="op">(</span><span class="va">mfairObject</span>,</span>
<span>  sf_para <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tol_stage2 <span class="op">=</span> <span class="fl">1e-6</span>, verbose_loop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Set K_max = 3!</span></span>
<span><span class="co">#&gt; Initialize the parameters of Factor 1......</span></span>
<span><span class="co">#&gt; After 3 iterations Stage 1 ends!</span></span>
<span><span class="co">#&gt; After 812 iterations Stage 2 ends!</span></span>
<span><span class="co">#&gt; Factor 1 retained!</span></span>
<span><span class="co">#&gt; Initialize the parameters of Factor 2......</span></span>
<span><span class="co">#&gt; After 3 iterations Stage 1 ends!</span></span>
<span><span class="co">#&gt; After 415 iterations Stage 2 ends!</span></span>
<span><span class="co">#&gt; Factor 2 retained!</span></span>
<span><span class="co">#&gt; Initialize the parameters of Factor 3......</span></span>
<span><span class="co">#&gt; After 2 iterations Stage 1 ends!</span></span>
<span><span class="co">#&gt; After 131 iterations Stage 2 ends!</span></span>
<span><span class="co">#&gt; Factor 3 retained!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatial-and-temporal-dynamics">Spatial and temporal dynamics<a class="anchor" aria-label="anchor" href="#spatial-and-temporal-dynamics"></a>
</h2>
<p>To gain insights, we visualize the dynamic patterns of the top three
factors across different neocortex areas and time periods, represented
by <span class="math inline">\(\{ F_1 (\cdot) , F_2 (\cdot) , F_3
(\cdot) \}\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OFC"</span>, <span class="st">"DFC"</span>, <span class="st">"VFC"</span>, <span class="st">"MFC"</span>, <span class="st">"M1C"</span>, <span class="st">"S1C"</span>, <span class="st">"IPC"</span>, <span class="st">"A1C"</span>, <span class="st">"STC"</span>, <span class="st">"ITC"</span>, <span class="st">"V1C"</span><span class="op">)</span></span>
<span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">region</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>  Stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">stage</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">FX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictFX.html">predictFX</a></span><span class="op">(</span><span class="va">mfairObject</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">X_new</span>,</span>
<span>  which_factors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalize each factor to have l2-norm equal one</span></span>
<span><span class="va">FX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">FX</span>,</span>
<span>  MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">FX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X_new</span>, <span class="va">FX</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">FX</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Neocortex area"</span>, <span class="st">"Time period"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Factor"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">FX</span><span class="op">[</span>, <span class="st">"Time period"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">FX</span><span class="op">[</span>, <span class="st">"Time period"</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">stage</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">FX</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Neocortex area Time period   Factor 1   Factor 2   Factor 3</span></span>
<span><span class="co">#&gt; 1            OFC           3 0.08541949 -0.1276331 -0.1413521</span></span>
<span><span class="co">#&gt; 2            DFC           3 0.08541949 -0.1304650 -0.1651130</span></span>
<span><span class="co">#&gt; 3            VFC           3 0.08557482 -0.1288645 -0.1367970</span></span>
<span><span class="co">#&gt; 4            MFC           3 0.08495090 -0.1271726 -0.1594441</span></span>
<span><span class="co">#&gt; 5            M1C           3 0.08557482 -0.1288645 -0.1607997</span></span>
<span><span class="co">#&gt; 6            S1C           3 0.08516747 -0.1288645 -0.1608590</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert the wide table to the long table</span></span>
<span><span class="va">FX_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">FX</span>,</span>
<span>  id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Neocortex area"</span>, <span class="st">"Time period"</span><span class="op">)</span>,</span>
<span>  variable.name <span class="op">=</span> <span class="st">"Factor"</span>, value.name <span class="op">=</span> <span class="st">"F"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">FX_long</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Neocortex area Time period   Factor          F</span></span>
<span><span class="co">#&gt; 1            OFC           3 Factor 1 0.08541949</span></span>
<span><span class="co">#&gt; 2            DFC           3 Factor 1 0.08541949</span></span>
<span><span class="co">#&gt; 3            VFC           3 Factor 1 0.08557482</span></span>
<span><span class="co">#&gt; 4            MFC           3 Factor 1 0.08495090</span></span>
<span><span class="co">#&gt; 5            M1C           3 Factor 1 0.08557482</span></span>
<span><span class="co">#&gt; 6            S1C           3 Factor 1 0.08516747</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization of F(.)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">FX_long</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">`Time period`</span>, y <span class="op">=</span> <span class="cn">F</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">`Neocortex area`</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">`Neocortex area`</span>,</span>
<span>    group <span class="op">=</span> <span class="va">`Neocortex area`</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>n.breaks <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>    panel.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span>, <span class="co"># Space between panels</span></span>
<span>    aspect.ratio <span class="op">=</span> <span class="fl">0.4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Factor</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="neocortex_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="gene-set-enrichment-analysis">Gene set enrichment analysis<a class="anchor" aria-label="anchor" href="#gene-set-enrichment-analysis"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inferred gene loadings (corresponding to the W matrix in the MFAI paper)</span></span>
<span><span class="va">gene_loadings</span> <span class="op">&lt;-</span> <span class="va">mfairObject</span><span class="op">@</span><span class="va">W</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mfairObject</span><span class="op">@</span><span class="va">Y</span><span class="op">)</span> <span class="co"># Assign gene symbols</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Loading"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Loading 1  Loading 2  Loading 3</span></span>
<span><span class="co">#&gt; DCUN1D2 -1.0973545  0.4754917 -0.4656467</span></span>
<span><span class="co">#&gt; ARRB1    3.7897678  0.5357535  0.3688403</span></span>
<span><span class="co">#&gt; PDE1B    0.1807732  3.1537712 -0.5730507</span></span>
<span><span class="co">#&gt; PDE7B   -0.1510914  3.2482200 -1.5126716</span></span>
<span><span class="co">#&gt; TOX      1.6022312 -1.6211514 -1.7326521</span></span>
<span><span class="co">#&gt; LOXHD1  -3.4764620  0.1372484  0.1020414</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Heatmap of the inferred gene loadings</span></span>
<span><span class="fu">pheatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>  clustering_method <span class="op">=</span> <span class="st">"complete"</span>,</span>
<span>  cluster_row <span class="op">=</span> <span class="cn">FALSE</span>, cluster_col <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  treeheight_row <span class="op">=</span> <span class="fl">0</span>, treeheight_col <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_rownames <span class="op">=</span> <span class="cn">TRUE</span>, show_colnames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cellwidth <span class="op">=</span> <span class="fl">0.2</span>, cellheight <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  fontsize <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="neocortex_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>We first calculated the relative weight of the <span class="math inline">\(k\)</span>-th loading for the <span class="math inline">\(m\)</span>-th gene by <span class="math inline">\(\left| W_{mk} \right| / \sum_{k^{\prime}=1}^{3}
\left| W_{mk^{\prime}} \right|\)</span>, where <span class="math inline">\(W_{m \cdot} \in \mathbb{R}^{3 \times 1}\)</span>
is the <span class="math inline">\(m\)</span>-th row of gene loadings,
and then selected the top 300 weighted genes in each loading to form the
gene sets.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalize each loading to have l2-norm equal one</span></span>
<span><span class="va">gene_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">gene_loadings</span>,</span>
<span>  MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Relative weight</span></span>
<span><span class="va">gene_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span></span>
<span><span class="va">gene_loadings</span> <span class="op">&lt;-</span> <span class="va">gene_loadings</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span></span>
<span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># Total number of genes M = 2,000</span></span>
<span><span class="va">ntop</span> <span class="op">&lt;-</span> <span class="va">M</span> <span class="op">*</span> <span class="fl">0.15</span> <span class="co"># We use the top 300 weighted genes in each loading to form the gene sets</span></span>
<span></span>
<span><span class="co"># Index of top genes</span></span>
<span><span class="va">top_gene_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">gene_loadings</span>,</span>
<span>  MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">ntop</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">top_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">top_gene_idx</span>,</span>
<span>  MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">gene_loadings</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">top_genes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Loading"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">top_genes</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Loading 1 Loading 2 Loading 3</span></span>
<span><span class="co">#&gt; [1,] "ARRB1"   "PDE1B"   "AJAP1"  </span></span>
<span><span class="co">#&gt; [2,] "LOXHD1"  "PDE7B"   "KCNA3"  </span></span>
<span><span class="co">#&gt; [3,] "TYRP1"   "KCNA2"   "ASTN2"  </span></span>
<span><span class="co">#&gt; [4,] "PRKG1"   "PMP22"   "EMID1"  </span></span>
<span><span class="co">#&gt; [5,] "MS4A8B"  "GPR155"  "GPR52"  </span></span>
<span><span class="co">#&gt; [6,] "FAM131B" "SMAD2"   "SEC24D"</span></span></code></pre></div>
<p>Then we can conduct the gene set enrichment analysis based on <a href="http://geneontology.org/" class="external-link">Gene Ontology</a> for each factor.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zhiwei Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
